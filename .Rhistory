stat_pointinterval(point_interval = "median_qi",
.width = c(0.95,0.99),
point_color = "red3") +
labs(title = "Visualising Confidence Intervals of Median Electricity Consumption",
x = "", y = "GWh", subtitle = paste0("Year ", givenyear)) +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
private_uncert
>>>>>>> Stashed changes
#Display rate of change using Slopegraph
#User can choose any 2 years for comparison
startyear <- 2005
endyear <- 2021
cons_yr <- dwelling
cons_year <- cons_yr %>%
group_by(DWELLING_TYPE, year) %>%
summarise(mean_cons=round(mean(consumption_GWh),2))
p_slopegraph <- cons_year %>%
mutate(year = factor(year)) %>%
filter(year %in% c(startyear,endyear)) %>%
newggslopegraph(year, mean_cons, DWELLING_TYPE)
p_slopegraph1 <- p_slopegraph + labs(title = "Monthly Household Electricity Consumption between 2 years",
subtitle = "",
caption = "Source:Singstat.gov.sg")
p_slopegraph1
<<<<<<< Updated upstream
#Display rate of change using Slopegraph
#User can choose any 2 years for comparison
startyear <- 2005
endyear <- 2021
cons_yr <- dwelling
cons_year <- cons_yr %>%
group_by(DWELLING_TYPE, year) %>%
summarise(mean_cons=round(mean(consumption_GWh),2))
p_slopegraph <- cons_year %>%
mutate(year = factor(year)) %>%
filter(year %in% c(startyear,endyear)) %>%
newggslopegraph(year, mean_cons, DWELLING_TYPE)
p_slopegraph1 <- p_slopegraph + labs(title = "Monthly Household Electricity Consumption between 2 years",
subtitle = "",
caption = "Source:ema.gov.sg")
p_slopegraph1
#linechart
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, fill = dwelling$DWELLING_TYPE))
#linechart
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE))
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE)) +
lab(title = "Electricity Consumption by Dwelling Type",
x = ("year"),
y = ("Consumption (GWh)"))
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE)) +
lab(title = "Electricity Consumption by Dwelling Type",
xlab = ("year"),
ylab = ("Consumption (GWh)"))
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE)) +
lab(title = "Electricity Consumption by Dwelling Type",
x = "year",
y = "Consumption (GWh)")
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE)) +
labs(title = "Electricity Consumption by Dwelling Type",
x = "year",
y = "Consumption (GWh)")
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE)) +
labs(title = "Electricity Consumption by Dwelling Type",
x = "Year", y = "Consumption (GWh)") +
theme(legend.position="bottom", legend.title = "")
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = dwelling$consumption_GWh, colour = dwelling$DWELLING_TYPE)) +
labs(title = "Electricity Consumption by Dwelling Type",
x = "Year", y = "Consumption (GWh)") +
theme(legend.position="bottom")
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = consumption_GWh, colour = DWELLING_TYPE)) +
labs(title = "Electricity Consumption by Dwelling Type",
x = "Year", y = "Consumption (GWh)") +
theme(legend.position="bottom")
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = consumption_GWh, colour = DWELLING_TYPE)) +
labs(title = "Electricity Consumption by Dwelling Type",
x = "Year", y = "Consumption (GWh)") +
scale_color_discrete(name="")
theme(legend.position="bottom")
#linechart # backup
ggplot(data = dwelling, aes(x = date)) +
geom_line(aes(y = consumption_GWh, colour = DWELLING_TYPE)) +
labs(title = "Electricity Consumption by Dwelling Type",
x = "Year", y = "Consumption (GWh)") +
scale_color_discrete(name="") +
theme(legend.position="bottom")
View(T3.5)
town <- T3.5[!(row.names(T3.5$Region) %in% c("Overall"))]
town <- subset(T3.5, Region != 'Overall')
View(town)
town <- subset(T3.5, Region != 'Overall'|'Central Region'|'East Region'|'North East Region'|'North Region'|'West Region')
town <- subset(T3.5, Region != 'Overall' &
Region !='Central Region'&
Region !='East Region'&
Region !='North East Region'&
Region !='North Region'&
Region !='West Region')
town <- subset(T3.5, Description != 'Overall' &
Description !='Central Region'&
Description !='East Region'&
Description !='North East Region'&
Description !='North Region'| 'West Region')
town <- subset(T3.5, Description != 'Overall' &
Description !='Central Region'&
Description !='East Region'&
Description !='North East Region'&
Description !='North Region'&
Description !='West Region')
## Read compressed data file
T2.3 <- readRDS(file = "RDS/T2-3.rds") # Peak System Demand
#T2.6 <- readRDS(file = "RDS/T2-6.rds") # Market Share of Electricity Generation
T3.4 <- readRDS(file = "RDS/T3-4.rds") # Total Household Electricity Consumption by Dwelling Type
T3.5 <- readRDS(file = "RDS/T3-5.rds") # Average Monthly Household Electricity Consumption by Planning Area & Dwelling Type
#T3.6 <- readRDS(file = "RDS/T3-6.rds") # Market Share for Natural Gas Retail
#T3.7 <- readRDS(file = "RDS/T3-7.rds") # Natural Gas Consumption by Sub-Sector
#T3.8 <- readRDS(file = "RDS/T3-8.rds") # Total Household Town Gas Consumption by Dwelling Type
#T3.9 <- readRDS(file = "RDS/T3-9.rds") # Average Monthly Household Town Gas Consumption by Planning Area & Dwelling Type
#T5.1 <- readRDS(file = "RDS/T5-1.rds") # Electricity and Gas Tariffs
#T5.2 <- readRDS(file = "RDS/T5-2.rds") # Monthly Electricity Tariffs (Low Tension Tariffs)
#T5.3 <- readRDS(file = "RDS/T5-3.rds") # Annual Electricity Tariffs by Components (Low Tension Tariffs)
#T5.4 <- readRDS(file = "RDS/T5-4.rds") # Average Monthly Uniform Singapore Energy Prices (USEP)
#T5.5 <- readRDS(file = "RDS/T5-5.rds") # Monthly Town Gas Tariffs
town <- subset(T3.5, Description != 'Overall' &
Description !='Central Region'&
Description !='East Region'&
Description !='North East Region'&
Description !='North Region'&
Description !='West Region')
=======
runApp('Shiny_App_G9')
# Clustering
library(cluster)
library(dendextend)
# Convert to factor
clus$Description <- factor(clus$Description)
clus$dwelling_type <- factor(clus$dwelling_type)
# calculate distance - can only use "gower" because data has categorical variable
clus_dist <- daisy(clus, metric="gower")
# hierarchical clustering using various methods
# (ward.D, ward.D2, single, complete, average, mcquitty, median, centroid)
# complete
hc <- hclust(clus_dist, method = "complete")
# Dendogram - k is for user to calibrate
plot(hc, label = FALSE, main = "Agglomerative, complete method")
rect.hclust(hc, k=6, border="gold3")
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
# Clustering
library(cluster)
library(dendextend)
# Convert to factor
clus$Description <- factor(clus$Description)
clus$dwelling_type <- factor(clus$dwelling_type)
# calculate distance - can only use "gower" because data has categorical variable
clus_dist <- daisy(clus, metric="gower")
# Clustering
library(cluster)
library(dendextend)
# Convert to factor
clus$Description <- factor(clus$Description)
clus$dwelling_type <- factor(clus$dwelling_type)
# calculate distance - can only use "gower" because data has categorical variable
clus_dist <- daisy(clus, metric="gower")
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 6, value =   c("grey20","darkslategray4", "darkslategray3", "gold3", "darkcyan", "cyan3")) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram, k = 6")
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
# Filter the required data for clustering
# remove month = "Annual"
# remove dewlling_type/description = Overall
# year 2018 and onwards due to missing data
# exclude "%region" in description
# Exclude Pioneer as data is incomplete
clus_data <- T3.5 %>%
filter(month != "Annual" &
year > 2017 &
dwelling_type != "Overall" &
!str_detect(Description,"Region|Pioneer|Overall"))
# transform dataset
# convert kwh into numbers
clus_data$kwh_per_acc <- as.numeric(clus_data$kwh_per_acc)
# join month and year into a date
clus_data$date <- parse_date_time(paste(clus_data$year, clus_data$month), orders=c("%Y %m"))
# drop month and year column
clus_data <- subset(clus_data, select=-c(month, year, Region)) %>%
arrange(date)
# pivot wider
clus <- clus_data %>%
pivot_wider(names_from=date, values_from=kwh_per_acc)
# omit na
clus <- na.omit(clus)
clus <- clus %>% relocate(Description, .before = dwelling_type)
runApp('Shiny_App_G9')
clus_data <- T3.5 %>%
filter(month != "Annual" &
year > 2017 &
dwelling_type != "Overall" &
!str_detect(Description,"Region|Pioneer|Overall"))
# transform dataset
# convert kwh into numbers
clus_data$kwh_per_acc <- as.numeric(clus_data$kwh_per_acc)
# join month and year into a date
clus_data$date <- parse_date_time(paste(clus_data$year, clus_data$month), orders=c("%Y %m"))
# drop month and year column
clus_data <- subset(clus_data, select=-c(month, year, Region)) %>%
arrange(date)
# pivot wider
clus <- clus_data %>%
pivot_wider(names_from=date, values_from=kwh_per_acc)
# omit na
clus <- na.omit(clus)
clus <- clus %>% relocate(Description, .before = dwelling_type)
# Convert to factor
clus$Description <- factor(clus$Description)
clus$dwelling_type <- factor(clus$dwelling_type)
# calculate distance - can only use "gower" because data has categorical variable
clus_dist <- daisy(clus, metric="gower")
output$dendro <- renderPlot({
hc <- hclust(clus_dist, method = "complete")
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 6, value = c("grey20","darkslategray4", "darkslategray3", "gold3", "darkcyan", "cyan3")) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram, k = 6")
})
output$dendro <- renderPlot({
hc <- hclust(clus_dist, method = "complete")
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 6, value = c("grey20","darkslategray4", "darkslategray3", "gold3", "darkcyan", "cyan3")) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram, k = 6")
})
runApp('Shiny_App_G9')
# hierarchical clustering using various methods
# (ward.D, ward.D2, single, complete, average, mcquitty, median, centroid)
# complete
hc <- hclust(clus_dist, method = "complete")
# Dendogram - k is for user to calibrate
plot(hc, label = FALSE, main = "Agglomerative, complete method")
rect.hclust(hc, k=6, border="gold3")
# hierarchical clustering using various methods
# (ward.D, ward.D2, single, complete, average, mcquitty, median, centroid)
# complete
hc <- hclust(clus_dist, method = "complete")
# Dendogram - k is for user to calibrate
plot(hc, label = FALSE, main = "Agglomerative, complete method")
rect.hclust(hc, k=6, border="gold3")
# function to create table for clustering stats
# Cluster stats comes out as list while it is more convenient to look at it as a table
# This code below will produce a dataframe with observations in columns and variables in row
# Not quite tidy data, which will require a tweak for plotting, but I prefer this view as an output here as I find it more comprehensive
library(fpc)
cstats.table <- function(dist, tree, k) {
clust.assess <- c("cluster.number","n","within.cluster.ss","average.within","average.between",
"wb.ratio","dunn2","avg.silwidth")
clust.size <- c("cluster.size")
stats.names <- c()
row.clust <- c()
output.stats <- matrix(ncol = k, nrow = length(clust.assess))
cluster.sizes <- matrix(ncol = k, nrow = k)
for(i in c(1:k)){
row.clust[i] <- paste("Cluster-", i, " size")
}
for(i in c(2:k)){
stats.names[i] <- paste("Test", i-1)
for(j in seq_along(clust.assess)){
output.stats[j, i] <- unlist(cluster.stats(d = dist, clustering = cutree(tree, k = i))[clust.assess])[j]
}
for(d in 1:k) {
cluster.sizes[d, i] <- unlist(cluster.stats(d = dist, clustering = cutree(tree, k = i))[clust.size])[d]
dim(cluster.sizes[d, i]) <- c(length(cluster.sizes[i]), 1)
cluster.sizes[d, i]
}
}
output.stats.df <- data.frame(output.stats)
cluster.sizes <- data.frame(cluster.sizes)
cluster.sizes[is.na(cluster.sizes)] <- 0
rows.all <- c(clust.assess, row.clust)
# rownames(output.stats.df) <- clust.assess
output <- rbind(output.stats.df, cluster.sizes)[ ,-1]
colnames(output) <- stats.names[2:k]
rownames(output) <- rows.all
is.num <- sapply(output, is.numeric)
output[is.num] <- lapply(output[is.num], round, 2)
output
}
library(sf)
# reading the map file
mpsz <- st_read(dsn = 'master-plan-2014-subzone-boundary-web-shp',
layer = 'MP14_SUBZONE_WEB_PL',
crs = 3414)
singapore <- st_transform(mpsz, 4326)
library(tmap)
# change Description to upper case
clus_hc$Description <- toupper(clus_hc$Description)
# Preparing the choropleth map
mpsz_clus <- left_join(singapore, clus_hc, by = c("PLN_AREA_N" = "Description"))
tmap_mode("view")
tm_shape(mpsz_clus)+
tmap_options(check.and.fix = TRUE)+
tm_fill("cluster", id=paste("PLN_AREA_N"),
style = "pretty",
palette = "Blues") +
tm_borders(alpha = 0.7)
runApp('Shiny_App_G9')
# function to create table for clustering stats
# Cluster stats comes out as list while it is more convenient to look at it as a table
# This code below will produce a dataframe with observations in columns and variables in row
# Not quite tidy data, which will require a tweak for plotting, but I prefer this view as an output here as I find it more comprehensive
library(fpc)
cstats.table <- function(dist, tree, k) {
clust.assess <- c("cluster.number","n","within.cluster.ss","average.within","average.between",
"wb.ratio","dunn2","avg.silwidth")
clust.size <- c("cluster.size")
stats.names <- c()
row.clust <- c()
output.stats <- matrix(ncol = k, nrow = length(clust.assess))
cluster.sizes <- matrix(ncol = k, nrow = k)
for(i in c(1:k)){
row.clust[i] <- paste("Cluster-", i, " size")
}
for(i in c(2:k)){
stats.names[i] <- paste("Test", i-1)
for(j in seq_along(clust.assess)){
output.stats[j, i] <- unlist(cluster.stats(d = dist, clustering = cutree(tree, k = i))[clust.assess])[j]
}
for(d in 1:k) {
cluster.sizes[d, i] <- unlist(cluster.stats(d = dist, clustering = cutree(tree, k = i))[clust.size])[d]
dim(cluster.sizes[d, i]) <- c(length(cluster.sizes[i]), 1)
cluster.sizes[d, i]
}
}
output.stats.df <- data.frame(output.stats)
cluster.sizes <- data.frame(cluster.sizes)
cluster.sizes[is.na(cluster.sizes)] <- 0
rows.all <- c(clust.assess, row.clust)
# rownames(output.stats.df) <- clust.assess
output <- rbind(output.stats.df, cluster.sizes)[ ,-1]
colnames(output) <- stats.names[2:k]
rownames(output) <- rows.all
is.num <- sapply(output, is.numeric)
output[is.num] <- lapply(output[is.num], round, 2)
output
}
# find optimal k - elbow method
ggplot(data = data.frame(t(cstats.table(clus_dist, hc, 15))),
aes(x=cluster.number, y=within.cluster.ss)) +
geom_point()+
geom_line()+
ggtitle("Agglomerative (complete) - Elbow") +
labs(x = "Num.of clusters", y = "Within clusters sum of squares (SS)") +
theme(plot.title = element_text(hjust = 0.5))
runApp('Shiny_App_G9')
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 10, value =   c("grey20","darkslategray4", "darkslategray3", "gold3", "darkcyan", "cyan3")) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram, k = 6")
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 3, value =   c("grey20","darkslategray4", "darkslategray3", "gold3", "darkcyan", "cyan3")) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram, k = 6")
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 3, value =   c("grey20","darkslategray4", "darkslategray3", "gold3", "darkcyan", "cyan3")) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram")
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 3, value =   rainbow()) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
dendro <- as.dendrogram(hc)
dendro.col <- dendro %>%
set("branches_k_color", k = 5, value =   rainbow(5)) %>%
set("branches_lwd", 0.6) %>%
set("labels_colors",
value = c("darkslategray")) %>%
set("labels_cex", 0.5)
ggd1 <- as.ggdend(dendro.col)
ggplot(ggd1, theme = theme_minimal()) +
labs(x = "Num. observations", y = "Height", title = "Dendrogram")
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
# find optimal k - elbow method
ggplot(data = data.frame(t(cstats.table(clus_dist, hc, 15))),
aes(x=cluster.number, y=within.cluster.ss)) +
geom_point()+
geom_line()+
ggtitle("Agglomerative (complete) - Elbow") +
labs(x = "Num.of clusters", y = "Within clusters sum of squares (SS)") +
theme(plot.title = element_text(hjust = 0.5))+
theme_dark()
# find optimal k - elbow method
ggplot(data = data.frame(t(cstats.table(clus_dist, hc, 15))),
aes(x=cluster.number, y=within.cluster.ss)) +
geom_point()+
geom_line()+
ggtitle("Agglomerative (complete) - Elbow") +
labs(x = "Num.of clusters", y = "Within clusters sum of squares (SS)") +
theme(plot.title = element_text(hjust = 0.5))+
theme_dark()
# find optimal k - elbow method
ggplot(data = data.frame(t(cstats.table(clus_dist, hc, 15))),
aes(x=cluster.number, y=within.cluster.ss)) +
geom_point()+
geom_line()+
ggtitle("Agglomerative (complete) - Elbow") +
labs(x = "Num.of clusters", y = "Within clusters sum of squares (SS)") +
theme(plot.title = element_text(hjust = 0.5), theme_dark())
runApp('Shiny_App_G9')
runApp('Shiny_App_G9/example')
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
# find optimal k - elbow method
ggplot(data = data.frame(t(cstats.table(clus_dist, hc, 15))),
aes(x=cluster.number, y=within.cluster.ss)) +
geom_point()+
geom_line()+
ggtitle("Agglomerative (complete) - Elbow") +
labs(x = "Num.of clusters", y = "Within clusters sum of squares (SS)") +
theme(plot.title = element_text(hjust = 0.5))+
theme_dark()
# find optimal k - elbow method
ggplot(data = data.frame(t(cstats.table(clus_dist, hc, 15))),
aes(x=cluster.number, y=within.cluster.ss)) +
geom_point()+
geom_line()+
ggtitle("Agglomerative (complete) - Elbow") +
labs(x = "Num.of clusters", y = "Within clusters sum of squares (SS)") +
theme(plot.title = element_text(hjust = 0.5))+
theme_dark()
# hierarchical clustering using various methods
# (ward.D, ward.D2, single, complete, average, mcquitty, median, centroid)
# complete
hc <- hclust(clus_dist, method = "ward.D")
# Dendogram - k is for user to calibrate
plot(hc, label = FALSE, main = "Agglomerative, complete method")
rect.hclust(hc, k=6, border="gold3")
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
library(tmap)
# change Description to upper case
clus_hc$Description <- toupper(clus_hc$Description)
# Preparing the choropleth map
mpsz_clus <- left_join(singapore, clus_hc, by = c("PLN_AREA_N" = "Description"))
tmap_mode("view")
tm_shape(mpsz_clus)+
tmap_options(check.and.fix = TRUE)+
tm_fill("cluster", id=paste("PLN_AREA_N"),
style = "pretty",
palette = "Blues") +
tm_borders(alpha = 0.7)
runApp('Shiny_App_G9')
runApp('Shiny_App_G9')
shiny::runApp('Shiny_App_G9')
>>>>>>> Stashed changes
